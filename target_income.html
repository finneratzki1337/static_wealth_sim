<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Target Income Calculator</title>
  <link rel="icon" href="assets/timo_logo.png" />
  <link rel="apple-touch-icon" href="assets/timo_logo.png" />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js" defer></script>
  <script src="target_bundle.js" defer></script>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <img class="brand-logo" src="assets/timo_logo.png" alt="Timo" />
      <div>
        <h1>Target Income Calculator</h1>
        <p class="subtitle">Find the monthly savings needed to fund a target retirement income.</p>
      </div>
    </div>
    <div class="header-actions">
      <a class="primary nav-link" href="index.html">Capital Development Simulator</a>
      <button id="transferToSimulator" class="primary" type="button">Transfer parameters</button>
      <button id="toggleTheme" class="ghost" type="button">Dark mode</button>
      <button id="msciDefaults" class="ghost">Use MSCI World-like defaults</button>
      <button id="copyLink" class="ghost">Copy Scenario Link</button>
      <button id="exportJson" class="ghost">Export JSON</button>
      <label class="ghost file-upload">
        Import JSON
        <input id="importJson" type="file" accept="application/json" />
      </label>
    </div>
  </header>

  <main class="app-grid">
    <section class="panel inputs">
      <h2>Inputs</h2>
      <div id="validationErrors" class="alert" hidden></div>

      <details>
        <summary>Target settings</summary>
        <div class="field-grid">
          <label>
            Target net monthly income
            <input id="targetNetMonthly" type="number" min="0" step="50" />
          </label>
          <label>
            Target income mode
            <select id="targetMode">
              <option value="nominal">Nominal (future euros)</option>
              <option value="real">Real (today's euros)</option>
            </select>
          </label>
          <label>
            Payout mode
            <select id="payoutMode">
              <option value="forever">Forever (interest-only)</option>
              <option value="untilAge">Until age</option>
            </select>
          </label>
          <label>
            End age (finite horizon)
            <input id="endAge" type="number" min="0" step="1" />
          </label>
        </div>
      </details>

      <details open>
        <summary>Core inputs</summary>
        <div class="field-grid">
          <label>
            Starting capital
            <input id="startCapital" type="number" min="0" step="100" />
          </label>
          <label>
            Assumed annual return (nominal %)
            <input id="annualReturnPre" type="number" step="0.1" />
          </label>
          <label>
            Inflation (annual %)
            <input id="inflationAnnual" type="number" step="0.1" />
          </label>
          <label>
            Current age (years)
            <input id="currentAge" type="number" min="0" step="1" />
          </label>
          <label>
            Desired retirement age
            <input id="retirementAge" type="number" min="0" step="1" />
          </label>
          <label>
            % of starting capital unrealized gain
            <input id="startGainPct" type="number" min="0" max="100" step="1" />
          </label>
          <label>
            Flat tax on gain (% of gains)
            <input id="taxRate" type="number" min="0" max="100" step="0.1" />
          </label>
          <label>
            Annual return after retirement (optional %)
            <input id="annualReturnPost" type="number" step="0.1" placeholder="same as pre-retirement" />
          </label>
        </div>
      </details>

      <details>
        <summary>Advanced savings</summary>
        <div class="field-grid">
          <label>
            % yearly increase of savings rate
            <input id="savingsIncreaseAnnualPct" type="number" step="0.1" />
          </label>
          <label>
            Maximum savings rate cap (optional)
            <input id="savingsCap" type="number" min="0" step="50" />
          </label>
          <label>
            Stop investing after X years (optional)
            <input id="stopInvestingAfterYears" type="number" min="0" step="1" />
          </label>
        </div>
      </details>

      <details>
        <summary>Monte Carlo</summary>
        <div class="field-grid">
          <label class="toggle">
            <input id="mcEnabled" type="checkbox" />
            Run Monte Carlo
          </label>
          <label>
            Number of runs (50–500)
            <input id="mcRuns" type="number" min="50" max="500" step="10" />
          </label>
          <label>
            Annual volatility σ (%)
            <input id="sigmaAnnual" type="number" min="0" step="0.1" />
          </label>
        </div>
      </details>

      <details>
        <summary>Crisis drawdown + recovery</summary>
        <div class="field-grid">
          <label class="toggle">
            <input id="crisisEnabled" type="checkbox" />
            Simulate crisis drawdown
          </label>
          <label>
            Crisis after N years
            <input id="crisisAfterYears" type="number" min="0" step="1" />
          </label>
          <label>
            Max drawdown in crisis year (%)
            <input id="crisisMaxDrawdown" type="number" min="0" max="100" step="1" />
          </label>
          <label>
            Recovery profile
            <select id="recoveryProfile">
              <option value="off">Off</option>
              <option value="fast">Fast (2 years)</option>
              <option value="typical">Typical (3.5 years)</option>
              <option value="gfc">GFC-like (4 years)</option>
              <option value="lostDecade">Dotcom / Lost-decade-like (10+ years)</option>
            </select>
          </label>
        </div>
      </details>

      <button id="runSimulation" class="primary">Run Calculation</button>
      <p class="note">Changes auto-run with a short delay when possible.</p>
    </section>

    <section class="panel outputs">
      <h2>Outputs</h2>
      <div class="summary-grid" id="requiredSavingsCard"></div>
      <div id="infeasibleWarning" class="alert" hidden></div>

      <div class="summary-grid" id="summaryCards"></div>

      <details class="chart-card" open>
        <summary>Deterministic projection</summary>
        <div id="deterministicChart" class="chart"></div>
      </details>

      <details class="chart-card" id="mcSection" open>
        <summary>Monte Carlo projection</summary>
        <div id="mcChart" class="chart"></div>
      </details>

      <details class="table-card" id="mcTableCard">
        <summary>Monte Carlo summary</summary>
        <div id="mcSummaryTable"></div>
      </details>

      <details class="table-card" id="mcYearlyTableCard">
        <summary>Monte Carlo year-by-year (percentiles)</summary>
        <div class="table-scroll" id="mcYearlyTable"></div>
      </details>

      <details class="table-card">
        <summary>Summary table</summary>
        <div id="summaryTable"></div>
      </details>

      <details class="table-card">
        <summary>Year-by-year table</summary>
        <div class="table-scroll" id="yearlyTable"></div>
      </details>
    </section>
  </main>

  <section class="panel assumptions">
    <details>
      <summary>Assumptions & Sources</summary>
      <div id="assumptionsContent"></div>
    </details>
  </section>

  <footer>
    <p>Educational use only. Not tax, legal, or investment advice.</p>
  </footer>
</body>
</html>
